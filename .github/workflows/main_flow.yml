name: main-flow
on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - 03_cd
jobs:
  clone-down:
    runs-on: production
    steps:
      - name: clone-down
        uses: actions/checkout@v2
      - name: Upload Repo
        uses: actions/upload-artifact@v2
        with: 
          name: code
          path: .
  build:
    runs-on: production
    # container: golang:latest ####
    needs: [Clone-down]
    steps:
      - name: Download Repo
        uses: actions/download-artifact@v2
        with: 
          name: code
          path: .
      - name: build-frontend
        run: cd frontend && go build .    
      - name: build-backend
        run: cd backend &&  go mod download github.com/gomodule/redigo && go build . 
  test:
    runs-on: production
    needs: [build]
    steps:
      - name: Download Repo
        uses: actions/download-artifact@v2
        with: 
          name: code
          path: .
      - name: test-front-end
        run: cd frontend && go test .  